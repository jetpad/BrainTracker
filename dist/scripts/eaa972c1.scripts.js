"use strict";var myApp=angular.module("myApp",["ui.bootstrap","ngTable","xeditable","angular-gestures","ngRoute"]);myApp.run(["editableOptions",function(a){a.theme="bs3"}]),myApp.directive("onReadFile",["$parse",function(){return{restrict:"A",scope:{onReadFile:"&"},link:function(a,b){b.on("change",function(b){var c=new FileReader;c.onload=function(b){a.$apply(function(){a.onReadFile({$content:b.target.result})})},c.readAsText((b.srcElement||b.target).files[0])})}}}]),myApp.directive("ngDownloadCsv",["$compile","$sce","dbService",function(a,b,c){return{restrict:"AE",template:"<a></a>",link:function(a,d,e){var f=e.title?e.title:"Download",g=e.filename?e.filename:"data.txt",h=e.trials?e.trials:!0;a.getUrl=function(){return b.trustAsResourceUrl(URL.createObjectURL(new Blob([c.exportToCSV(h)],{type:"text/csv"})))},c.ready()?(d.children()[0].href=a.getUrl(),d.children()[0].innerHTML=f,d.children()[0].target="_blank",d.children()[0].download=g):(d.children()[0].href="",d.children()[0].innerHTML="Loading...",d.children()[0].download=g),a.$on("sessionDataChanged",function(){console.log("Export.sessionDataChanged"),d.children()[0].href=a.getUrl(),d.children()[0].target="_blank",d.children()[0].innerHTML=f,d.children()[0].download=g})}}}]);var now=function(){var a=window.performance||{};return a.now=function(){return a.now||a.webkitNow||a.msNow||a.oNow||a.mozNow||function(){return(new Date).getTime()}}(),a.now()};myApp.config(["$routeProvider","$locationProvider",function(a){a.when("/",{templateUrl:"views/main.html"}).when("/contact",{templateUrl:"views/contact.html"}).when("/about",{templateUrl:"views/about.html"}).when("/import",{templateUrl:"views/import.html"}).when("/report",{templateUrl:"views/session-report.html",controller:"SessionsReportControl"}).when("/chart",{templateUrl:"views/sessions-chart.html",controller:"SessionsChartControl"}).when("/results",{templateUrl:"views/results.html"}).when("/testreport",{templateUrl:"views/testreport.html"}).when("/signout",{templateUrl:"views/signout.html"}).when("/results",{templateUrl:"views/results.html"}).when("/test",{templateUrl:"views/reaction-number.html"}).when("/testcomplete",{templateUrl:"views/test-complete.html"}).otherwise({redirectTo:"/"})}]),myApp.service("dbService",["$location","$q","safeApply","$filter","$rootScope","$timeout",function(a,b,c,d,e,f){function g(a,b){return function(d,f){c(e,function(){d?(console.log('dbService "'+b+'" returned error',d),a.reject(d)):(console.log('dbService "'+b+'" returned successfully',f),a.resolve(f))})}}var h,i=null,j=null,k=null,l=this,m=null;this.initialize=function(){return h=new Dropbox.Client({key:"46tjf8x15q98xic"}),console.log("Initialize"),l.authenticate({interactive:!1})},this.sessions=function(){return m},this.isAuthenticated=function(){return h.isAuthenticated()},this.isDatastoreOpen=function(){return!(null===i)},this.getDatastore=function(){return i},this.deleteDatastore=function(a){var c=b.defer();return j.deleteDatastore(a,g(c,"deleteDatastore")),c.promise},this.createDatastore=function(){var a=b.defer();return j.createDatastore(function(b,d){c(e,function(){b?(console.log("Error creating datastore: "+b),a.reject(b)):(console.log("successfully created new datastore"),i=d,l.openTables(),a.resolve(d))})}),a.promise},this.listDatastores=function(){var a=b.defer();return j.listDatastores(function(b,d){c(e,function(){b?(console.log("Error opening default datastore: "+b),a.reject(b)):a.resolve(d)})}),a.promise},this.openDatastore=function(a){var d=b.defer();return l.isDatastoreOpen()&&i.getId()==a?(d.resolve(i),d.promise):(j.openDatastore(a,function(a,b){c(e,function(){a?(console.log("Error opening default datastore: "+a),d.reject(a)):(i=b,l.openTables(),d.resolve(b))})}),d.promise)},this.openDefaultDatastore=function(){var a=b.defer();if(this.isDatastoreOpen()&&"default"==i.getId())return a.resolve(i),a.promise;var d=now();return j.openDefaultDatastore(function(b,f){c(e,function(){if(b)console.log("Error opening default datastore: "+b),a.reject(b);else{console.log("successfully opened default datastore");var c=now();console.log("Time to get datastore: ",Math.round(c-d)," (ms)"),i=f,l.openTables(),a.resolve(f)}})}),a.promise},this.authenticate=function(a){var d=b.defer();return l.ready()?(d.resolve(i),d.promise):(h.authenticate(a,function(a){c(e,function(){a?(console.log("Authentication error: "+a),d.reject(a)):h.isAuthenticated()?(j=h.getDatastoreManager(),l.openDefaultDatastore(i).then(function(a){console.log("authenticate success"),d.resolve(a)},function(a){console.log("Error opening default datastore: "+a),d.reject(a)})):d.reject()})}),d.promise)},this.openTables=function(){k=i.getTable("session");var a=now(),b=k.query(),c=now();console.log("sessions query elapsed time: ",Math.round(c-a)),m=l.sessionToObjectArray(b),a=now(),this.sortArrayByStarttime(m),c=now(),console.log("sessions sort elapsed time: ",Math.round(c-a)),e.$broadcast("sessionDataChanged"),l.subscribeRecordsChanged(function(a){console.log("a session record has changed: ",a.length);for(var b=0;b<a.length;b++)for(var c=m.length-1;c>=0;c--)m[c].id==a[b].getId()&&m.splice(c,1);m=m.concat(l.sessionToObjectArray(a));var d=now();l.sortArrayByStarttime(m);var f=now();console.log("sessions sort elapsed time: ",f-d),e.$broadcast("sessionDataChanged")},"session")},this.sortArrayByStarttime=function(a){a.sort(function(a,b){return new Date(a.starttime)-new Date(b.starttime)})},this.ready=function(){return k&&Dropbox.Datastore.Table.isValidId(k.getId())?!0:!1},this.sessionRecordCount=function(){return null===k?0:m.length},this.close=function(){j&&j.close()};var n=function(a){return function(b){c(e,function(){a(b)})}};this.subscribeRecordsChanged=function(a,b){var c=function(){};return c=n(b?function(c){var d=c.affectedRecordsForTable(b);a(d)}:a),i.recordsChanged.addListener(c),c},this.updateSessionField=function(a,b,c){if(k&&Dropbox.Datastore.Record.isValidId(a)){var d=k.get(a);d.set(b,c)}},this.sessionToObjectArray=function(a){for(var b=gauss.Vector,c=[],d=now(),e=0;e<a.length;e++){var f=a[e].getFields(),g=b(f.trials.split(",").map(function(a){return parseInt(a,10)}));f.trials=g,f.id=a[e].getId(),c.push(f)}var h=now();return console.log("convert to array elapsed time: ",Math.round(h-d)),c},this.addSessions=function(a){console.log("Adding sessions");for(var b=0;b<a.length;b++)l.addSession(a[b]);console.log("Finished adding sessions")},this.backgroundAddSessions=function(a){function c(){f(function(){console.log("Processing a session:",e),l.addSession(a[e],e),d.notify({idx:e,max:a.length}),e++,e<a.length?c():(console.log("Finished background adding of sessions"),d.resolve({idx:e,max:a.length}))},0)}console.log("Started background adding of sessions");var d=b.defer(),e=0;return c(),d.promise},this.errorPercent=function(a){var b=a.trials.find({include:!0}).length,c=a.trials.find({correct:!0,include:!0}).length,d=Math.round(b-c),e=Math.round(d/b*100);return console.log("chances:",b," correct:",c," errors:",d," percent:",e),e},this.addSession=function(a,b){var c="undefined"!=typeof b?!0:!1;a.latency=Math.round(a.trials.find({include:!0,correct:!0}).map(function(a){return a.latency}).mean()),a.errorpercent=this.errorPercent(a);for(var d=[],e=0;e<a.trials.length;e++)1==a.trials[e].include&&1==a.trials[e].correct&&d.push(a.trials[e].latency);if(isNaN(a.latency))return null;var f={starttime:a.starttime,endtime:a.endtime,latency:a.latency,errorpercent:a.errorpercent,testtype:a.testtype,duration:a.duration,trials:d.join(",")};if(a.notes&&(f.notes=a.notes),1==c){var g=k.getOrInsert("csv_import_"+b,f);g.deleteRecord(),g=k.getOrInsert("csv_import_"+b,f)}else var g=k.insert(f);return g},this.authenticatedNavigate=function(b){1==this.isAuthenticated()?a.path(b):(h.reset(),this.authenticate({interactive:!0}).then(function(){console.log("authenticated successs")},function(a){console.log("error authenticating({interactive: true}): "+a),this.initialize()}))},this.signout=function(){i=null,0==this.isAuthenticated()?(console.log("not authenticated, signing out"),a.path("/signout")):(new function(){var c=b.defer();return k=null,a.path("/signout"),h.signOut({mustInvalidate:!0},g(c,"signOut")),c.promise}).then(function(){console.log("signing out")},function(){console.log("Error signing out")})},this.CSVToArray=function(a,b){b=b||",";for(var c=new RegExp("(\\"+b+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+b+"\\r\\n]*))","gi"),d=[[]],e=null;e=c.exec(a);){var f=e[1];if(f.length&&f!=b&&d.push([]),e[2])var g=e[2].replace(new RegExp('""',"g"),'"');else var g=e[3];d[d.length-1].push(g)}return d},this.stringifyCell=function(a){var b='"';return"string"==typeof a?(a=a.replace(/"/g,'""'),a=b+a+b):"boolean"==typeof a?a?"TRUE":"FALSE":a},this.exportToCSV=function(){var a=["session","starttime","endtime","duration","meanlatency","errorpercent","testtype","notes"];a+="\r\n";var b=this.sessions();if(b)for(var c=0;c<b.length;c++){var e=b[c],f=[];f.push(l.stringifyCell(c+1)),f.push(l.stringifyCell(d("date")(e.starttime,"yyyy-MM-dd HH:mm:ss"))),f.push(l.stringifyCell(d("date")(e.endtime,"yyyy-MM-dd HH:mm:ss"))),f.push(l.stringifyCell(e.duration)),f.push(l.stringifyCell(e.latency)),f.push(l.stringifyCell(e.errorpercent)),f.push(l.stringifyCell(e.testtype)),f.push(l.stringifyCell(e.notes)),f.push(e.trials),a+=f.join(","),a+="\r\n"}return a},this.parseTrialstoSessions=function(a){for(var b,c=[],d={},e={},f=gauss.Vector,g=1;g<a.length-1;g++){var h=a[g];h[2]!=b&&(b=h[2],1!=g&&c.push(d),d={},d.notes=b.substr(17).trim(),0==d.notes.length&&(d.notes="-blank-"),d.starttime=this.parseDateFromR(h[1]),d.minlatency=150,d.maxlatency=3e3,d.testtype="S",d.testversion=1,d.delay=Math.round(h[4]),d.trials=new f),d.endtime=this.parseDateFromR(h[1]),d.duration=Math.round((d.endtime-d.starttime)/1e3),e={},e.problem=h[5],e.answer=h[8],e.latency=Math.round(h[6]),e.include="TRUE"==h[10]?!0:!1,e.correct="TRUE"==h[9]?!0:!1,e.warmup="warmup"==h[11]?!0:!1,e.correction="correction trial"==h[11]?!0:!1,d.trials.push(e)}return c.push(d),c},this.parseDateFromR=function(a){var b=/^(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(.*)/,c=a.match(b);return new Date(Number(c[1]),Number(c[2]-1),Number(c[3]),Number(c[4]),Number(c[5]),Number(c[6]))}}]),myApp.factory("safeApply",[function(){return function(a,b){var c=a.$root.$$phase;"$apply"==c||"$digest"==c?b&&a.$eval(b):b?a.$apply(b):a.$apply()}}]),myApp.controller("MainCtrl",["$scope","$rootScope","$modal","$q","$http","$location","dbService",function(a,b,c,d,e,f,g){if("http"==f.protocol()&&"localhost"!=f.host()&&"127.0.0.1"!=f.host()&&"server"!=f.host()){var h="https:"+f.absUrl().substr(5);window.location=h}a.dbService=g,g.initialize().then(function(){}),a.version="0.0.1",a.displayMessage=function(a){$window.alert(a)},a.importCSV=function(){var b=g.CSVToArray(a.content),d=g.parseTrialstoSessions(b);g.backgroundAddSessions(d).then(function(b){a.importIndex=b.idx,a.importMax=b.max;var d=c.open({templateUrl:"views/finishedimport.html"});d.result.then(function(){f.path("/")},function(){f.path("/")})},function(){},function(b){a.importIndex=b.idx,a.importMax=b.max})},a.showContent=function(b){a.content=b}}]),myApp.directive("ngSparkline",function(){return{restrict:"AE",require:"^ngModel",scope:{ngModel:"="},template:'<div class="sparkline"></div>',link:function(a,b,c){a.dummydata=function(){for(var a=[[],[],[]],b=new Rickshaw.Fixtures.RandomData(150),c=0;150>c;c++)b.addData(a);return a[0]},a.histogram=function(a,b){var c=d3.layout.histogram().bins(b)(a.toArray());return c};var d=new Rickshaw.Graph({element:b.children()[0],width:c.width?c.width:80,height:c.height?c.height:20,renderer:"bar",min:"auto",series:[{color:"#c05020",data:a.histogram(a.ngModel,c.bins?c.bins:12),name:"Histogram"}]});d.render()}}}),myApp.controller("SessionsReportControl",["$scope","$rootScope","$filter","$timeout","$q","$http","$location","safeApply","ngTableParams","dbService",function(a,b,c,d,e,f,g,h,i){a.$on("sessionDataChanged",function(){console.log("Updating Report"),a.tableParams.reload()}),a.saveNotes=function(b,c){return console.log("saving session notes: ",b," for id: ",c),a.dbService.updateSessionField(c,"notes",b),!0};var j=function(){return a.dbService.sessions()?a.dbService.sessions():[]};a.tableParams=new i({page:1,count:100,sorting:{starttime:"desc"}},{total:function(){return j().length},getData:function(a,b){var d=j(),e=b.sorting()?c("orderBy")(d,b.orderBy()):d;b.total(e.length),a.resolve(e.slice((b.page()-1)*b.count(),b.page()*b.count()))},$scope:{$data:{}}})}]),myApp.controller("SessionsChartControl",["$scope","$rootScope","$filter","$window","$timeout","$q","$http","$location","safeApply","ngTableParams","dbService",function(a,b,c,d){var e=this;this.getData=function(){var b=a.dbService.sessions()?a.dbService.sessions():[],c=[];0==b.length&&(c=[{x:0,y:0}]);for(var d=0;d<b.length;d++)c.push({x:b[d].starttime.getTime()/1e3,y:b[d].latency,r:b[d].trials.stdev()/8});return c};{var f=new Rickshaw.Graph({element:document.querySelector("#chart"),width:800,height:400,renderer:"scatterplot",stroke:!0,padding:{top:.05,left:.05,right:.05},preserve:!0,series:[{name:"",className:"scatterplot-circle",data:this.getData()}]}),g=(new Rickshaw.Graph.Axis.Time({graph:f}),new Rickshaw.Graph.Axis.Y({graph:f,orientation:"right",tickFormat:Rickshaw.Fixtures.Number.formatKMBT}),new Rickshaw.Graph.HoverDetail({graph:f,xFormatter:function(){return null},formatter:function(a,b,d){var e='<span class="date">'+c("date")(1e3*b,"medium")+"</span>",f='<span class="detail_swatch" style="background-color: '+a.color+'"></span>',g=f+a.name+"latency: "+parseInt(d)+" (ms)<br>"+e;return g}}),function(){if(null!=document.querySelector("#chart")){console.log("refreshChart");{var a=window.innerWidth-40-2*document.querySelector("#chart").offsetLeft,b=20;new Rickshaw.Graph.RangeSlider.Preview({graph:f,width:a+2*b,frameHandleThickness:b,renderer:"scatterplot",element:document.querySelector("#preview")})}f.configure({width:a,height:window.innerHeight-2*document.querySelector("#chart").offsetTop}),f.configure({renderer:"scatterplot"}),f.render()}});angular.element(d)}a.$on("sessionDataChanged",function(){console.log("Updating Chart"),f.series[0].data=e.getData(),g()})}]),myApp.controller("ResultsControl",["$scope","$rootScope","$filter","$timeout","$q","$http","$location","safeApply","ngTableParams","dbService",function(a,b){a.refreshResults=function(){b.$broadcast("sessionDataChanged")}}]),myApp.controller("ExportControl",["$scope","dbService",function(a){a.$on("sessionDataChanged",function(){})}]),myApp.factory("ReactionTimeTrial",["$timeout",function(a){var b;return b=function(){function b(){var b=this;this.starttime=now(),this.minimumtime=100,this.maximumtime=2e3,this.phase="waiting",this.correction=!1,this.delay=1500,this.warmup=!1,a.cancel(this.delayPromise),this.delayPromise=a(function(){return b.enterGoPhase()},this.delay)}return b.prototype.validTrial=function(){return 0==this.warmup&&0==this.correction&&1==this.correct?!0:!1},b.prototype.enterGoPhase=function(){if(!this.problem){var a=["2","3","4","5","6","7","8"];this.problem=a[Math.floor(Math.random()*a.length)]}return this.phase="go",this.starttime=now(),this.timestamp=new Date,this.starttime},b.prototype.reactionClick=function(){switch(a.cancel(this.delayPromise),this.endtime=now(),this.latency=Math.round(this.endtime-this.starttime),this.phase="result",this.starttime||(this.phase="too-fast"),this.endtime-this.starttime<this.minimumtime&&(this.phase="too-fast"),this.endtime-this.starttime>this.maximumtime&&(this.phase="too-slow"),this.answer!=this.problem&&(console.log("wrong-number!!!"),this.phase="wrong-number"),this.phase){case"too-fast":this.correct=!1;break;case"too-slow":this.correct=!1;break;case"wrong-number":this.correct=!1;break;default:console.log("Correct!"),this.correct=!0}return this.latency},b}()}]).factory("ReactionTimeSession",["ReactionTimeTrial","$http","$rootScope","$location","dbService",function(a,b,c,d,e){var f;return f=function(){function b(){this.initialize()}return b.prototype.initialize=function(){this.trials=[],this.currentTrial=null,this.correctionTrial=!1,this.warmup=!1,this.maxTrials=32,this.notes=null},b.prototype.start=function(){return this.nextTrial()},b.prototype.nextTrial=function(){var b=new a(this);return 1==this.correctionTrial&&(b.problem=this.currentTrial.problem,b.correction=!0),this.currentTrial=b},b.prototype.clickedNumber=function(a){switch(this.getValidTrials()>=this.getMaxTrials()&&(this.saveNotes(),this.saveSession(),console.log("test complete"),d.path("/testcomplete")),this.getView()){case"splash":this.start();break;case"waiting":this.reactionClick();break;case"go":this.currentTrial&&a&&(this.currentTrial.answer=a),this.reactionClick();break;default:this.nextTrial()}},b.prototype.reactionClick=function(){if(this.currentClickTime=new Date,Math.abs(this.currentClickTime-this.lastClickTime)<300)return this.getView();switch(this.lastClickTime=this.currentClickTime,this.currentTrial.reactionClick(),this.currentTrial.phase){case"too-fast":case"too-slow":case"wrong-number":this.correctionTrial=!0;break;case"result":default:1==this.currentTrial.correct?(this.correctionTrial=!1,this.currentTrial.delayPromise=null):this.correctionTrial=!0}this.trials.push(this.currentTrial)},b.prototype.getView=function(){return null==this.currentTrial?"splash":this.getValidTrials()>=this.getMaxTrials()?"session-complete":this.currentTrial.phase},b.prototype.getAverage=function(){for(var a=0,b=0,c=0;c<this.trials.length;c++)this.trials[c].validTrial()&&(b+=this.trials[c].latency,a+=1);return b/a||0},b.prototype.getValidTrials=function(){for(var a=0,b=0;b<this.trials.length;b++)this.trials[b].validTrial()&&(a+=1);return a},b.prototype.getMaxTrials=function(){var a=this.maxTrials;return a},b.prototype.getProblem=function(){var a=0;return this.currentTrial&&this.currentTrial.problem&&(a=this.currentTrial.problem),a},b.prototype.getNumberClass=function(a){return this.currentTrial&&this.currentTrial.answer&&this.currentTrial.answer!=this.getProblem()&&a==this.currentTrial.answer?"number-wrong":a!=this.getProblem()?"number-disabled":"waiting"==this.getView()?"number-disabled":"number-selected"},b.prototype.cancelLastTrial=function(){console.log("Cancel Last Trial");for(var a=this.trials.length-1;a>=0;a--){if(this.trials[a].validTrial()){this.trials.pop();break}this.trials.pop()}},b.prototype.endSession=function(){console.log("End Session"),this.initialize()},b.prototype.setMessage=function(a){this.message=a},b.prototype.getMessage=function(){return this.message},b.prototype.getNotes=function(){return this.notes},b.prototype.setNotes=function(a){console.log("setNotes: ",a),this.notes=a},b.prototype.saveSession=function(){var a=gauss.Vector,b={};b.trials=new a;var c=this.trials;if(0==c.length)return null;for(var d=0;d<c.length;d++){var f={},g=c[d];f.problem=g.problem,f.answer=g.answer,f.latency=Math.round(g.latency),f.include=0==g.correction&&0==g.warmup,f.correct=g.correct,f.warmup=g.warmup,f.correction=g.correction,b.trials.push(f)}return b.notes=this.notes,b.starttime=new Date(c[0].timestamp),b.endtime=new Date(c[c.length-1].timestamp),b.duration=Math.round((b.endtime-b.starttime)/1e3),b.testtype="A",console.log("saveSession: ",b),this.initialize(),e.addSession(b)},b}()}]),myApp.controller("ReactionTimeCtrl",["$scope","ReactionTimeSession",function(a,b){return a.test=new b,a.session={notes:null},a.test.saveNotes=function(){a.test.setNotes(a.session.notes)},a.test.hello=function(){var b;b.then(function(b){a.test.message=b.message[0],console.log("result.message[0]:",b.message[0]," result:",b)},function(a){console.log("hello status:",a)})},a.test.saveTrials=function(){{var a;this.trials}a.then(function(a){console.log("saveTrials:",a)},function(a){console.log("saveTrials status:",a)})},a.test}]);var overwriteWithout=function(a,b){for(var c=a.length;c>=0;c--)a[c]===b&&a.splice(c,1)},isSet=function(a,b){return _.isUndefined(b)?!1:""===b?!0:a.$eval(b)};myApp.factory("shortcuts",["$document",function(a){var b=[],c={"delete":8,tab:9,enter:13,"return":13,esc:27,space:32,left:37,up:38,right:39,down:40,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},d=function(a,b){for(var d=a.length,e=0;d>e;e++)c[a[e]]=b+e};d("1234567890",49),d("abcdefghijklmnopqrstuvwxyz",65);var e={};_.forEach(c,function(a,b){e[a]=b});var f={shift:"shift",ctrl:"ctrl",meta:"meta",alt:"alt"},g=function(a){var b=a.split("+"),d={};return _.forEach(f,function(a){d[a]=!1}),_.forEach(b,function(a){var b=f[a];if(b)d[b]=!0;else if(d.keyCode=c[a],!d.keyCode)return}),d},h=function(a){var b={};return b.keyCode=c[e[a.which]],b.meta=a.metaKey||!1,b.alt=a.altKey||!1,b.ctrl=a.ctrlKey||!1,b.shift=a.shiftKey||!1,b},i=function(a,b){return a.keyCode===b.keyCode&&a.ctrl===b.ctrl&&a.alt===b.alt&&a.meta===b.meta&&a.shift===b.shift};return a.bind("keydown",function(a){var c=$(a.target);if(!c.is('input[type="text"], textarea'))for(var d,e=h(a),f=b.length-1;f>=0;f--)if(d=b[f],i(e,d.keys))return a.preventDefault(),void d.action()}),{shortcuts:b,register:function(a){return a.keys=g(a.keySet),a.keys?(b.push(a),a):void 0},unregister:function(a){overwriteWithout(b,a)}}}]),myApp.directive("ngShortcut",["$parse","shortcuts",function(a,b){return{restrict:"A",link:function(c,d,e){var f=c.$eval(e.ngShortcut);if(!_.isUndefined(f)){f=f.split("|");var g=_.ignore,h=function(a){return function(){d.trigger(a)}};if(isSet(c,e.ngShortcutClick))g=h("click");else if(isSet(c,e.ngShortcutFocus))g=h("focus");else if(isSet(c,e.ngShortcutFastClick))g=h("click");else if(e.ngShortcutNavigate){var i=c.$eval(e.ngShortcutNavigate);g=function(){navigation.redirect(i,!0)}}else if(e.ngShortcutAction){var j=a(e.ngShortcutAction);g=function(){c.$apply(function(){j(c)})}}_.forEach(f,function(a){var d=b.register({keySet:a,action:g,description:e.ngShortcutDescription||""});c.$on("$destroy",function(){b.unregister(d)})})}}}}]);