"use strict";function MainCtrl(a,b,c,d,e,f){a.dbService=f,f.initialize(),a.displayMessage=function(a){$window.alert(a)}}var myApp=angular.module("myApp",["ui.bootstrap","dropstore-ng","recordWrapper","angular-gestures","ngRoute"]);myApp.config(["$routeProvider","$locationProvider",function(a){a.when("/",{templateUrl:"views/main.html"}).when("/contact",{templateUrl:"views/contact.html"}).when("/about",{templateUrl:"views/about.html"}).when("/signout",{templateUrl:"views/signout.html"}).when("/results",{templateUrl:"views/results.html"}).when("/test",{templateUrl:"views/reaction-number.html"}).otherwise({redirectTo:"/"})}]),myApp.service("dbService",["$location","$q","dropstoreClient",function(a,b,c){var d=null,e=!1;this.initialize=function(){c.create({key:"46tjf8x15q98xic"}),0==c.isAuthenticated()&&(e=!1,this.authenticate(!1))},this.isAuthenticated=function(){return console.log("dbService.auth isAuthenticated:",e),e},this.authenticate=function(a){console.log("dbService: authenticate: isAuthenticated:",e),a="undefined"!=typeof a?a:!0,console.log("MainCtrl.authenticate(interactive: ",a,")");var f=b.defer();c.create({key:"46tjf8x15q98xic"}).authenticate({interactive:a}).then(function(){return e=!0,console.log("Authentication Success: isAuthenticated:",e),f.resolve(),f.promise},function(a){return console.log("Authentication Failed: "+a),f.reject(),f.promise}).then(function(a){console.log("completed openDefaultDatastore"),d=a})},this.authenticatedNavigate=function(b){1==e?a.path(b):this.authenticate()},this.signout=function(){console.log("dbService: in the controller signout: isAuthenticated:",e," dropstoreClient:",c),0==e&&console.log("dbService: signout: user was already signed out.: isAuthenticated:",e),(1==e||1==c.isAuthenticated())&&(console.log("dbService: signout: inconsistency in authentication state"),e=!1),0==c.isAuthenticated()&&(console.log("dbService: dropstoreClient says already signed out so not going to try it again."),a.path("/signout")),c.signOut({mustInvalidate:!0}).then(function(){console.log("dbService: signout: successful: isAuthenticated:",e),e=!1,a.path("/signout")},function(){console.log("dbService: signout: failure: isAuthenticated:",e),a.path("/signout")})}}]);var mainCtrl=angular.module("MainCtrl",[]);myApp.factory("ReactionTimeTrial",["$timeout",function(a){var b;return b=function(){function b(){var b=this;this.minimumTime=100,this.maximumTime=2e3,this.phase="waiting",this.correction=!1,this.timeWaited=1500,this.latencyptile=null,a.cancel(this.delayPromise),this.delayPromise=a(function(){return b.enterGoPhase()},this.timeWaited)}return b.prototype.enterGoPhase=function(){if(!this.problem){var a=["2","3","4","5","6","7","8"];this.problem=a[Math.floor(Math.random()*a.length)]}return this.phase="go",this.startTime=new Date,this.startTime},b.prototype.reactionClick=function(){switch(a.cancel(this.delayPromise),this.endTime=new Date,this.latencymsec=this.endTime-this.startTime,this.phase="result",this.startTime||(this.phase="too-fast"),this.endTime-this.startTime<this.minimumTime&&(this.phase="too-fast"),this.endTime-this.startTime>this.maximumTime&&(this.phase="too-slow"),this.answer!=this.problem&&(console.log("wrong-number!!!"),this.phase="wrong-number"),this.phase){case"too-fast":this.correct=!1;break;case"too-slow":this.correct=!1;break;case"wrong-number":this.correct=!1;break;default:console.log("TRIAL: ",angular.toJson(this)),this.correct=!0,this.include=!0}return this.latencymsec},b}()}]).factory("ReactionTimeSession",["ReactionTimeTrial","$http",function(a){var b;return b=function(){function b(){this.initialize()}return b.prototype.initialize=function(){this.trials=[],this.currentTrial=null,this.trialCount=0,this.correctionTrial=!1,this.warmup=!1,this.maxTrials=4},b.prototype.start=function(){return this.nextTrial()},b.prototype.nextTrial=function(){var b=new a(this);return 1==this.correctionTrial&&(b.problem=this.currentTrial.problem,b.correction=!0),b.include=1==this.warmup||1==this.correctionTrial?!1:!0,0==b.include&&console.log("NOT INCLUDING the _nextTrial"),this.currentTrial=b},b.prototype.clickedBg=function(){return this.getView()},b.prototype.clickedNumber=function(a){switch(this.currentTrial&&(this.currentTrial.answer=a?a:String.fromCharCode(event.keyCode)),this.getView()){case"splash":return this.start();case"waiting":return this.reactionClick();case"go":return this.reactionClick();default:return this.nextTrial()}},b.prototype.reactionClick=function(){if(this.currentClickTime=new Date,Math.abs(this.currentClickTime-this.lastClickTime)<300)return this.getView();switch(this.lastClickTime=this.currentClickTime,console.log("session.reactionClick: ",this.currentTrial.phase),this.currentTrial.reactionClick(),console.log("trial.reactionClick: ",this.currentTrial.phase),this.currentTrial.phase){case"too-fast":case"too-slow":case"wrong-number":this.correctionTrial=!0;break;case"result":default:1==this.currentTrial.include?(console.log(" Including the trial"),0==this.correctionTrial&&(this.trialCount=this.trialCount+1),this.correctionTrial=!1,this.currentTrial.delayPromise=null,console.log("TRIALS: ",angular.toJson(this.trials,!0),",")):(console.log(" Excluding the trial"),this.correctionTrial=!0)}return this.trials.push(this.currentTrial)},b.prototype.showSaveButton=function(){return this.trials.length>=5},b.prototype.getView=function(){var a;return this.saving?"saving":(null!=(a=this.currentTrial)?a.phase:void 0)||"splash"},b.prototype.getAverage=function(){var a,b,c,d,e;for(a=0,e=this.trials,c=0,d=e.length;d>c;c++)b=e[c],a+=b.latencymsec;return a/this.trials.length||0},b.prototype.getValidTrials=function(){return this.trialCount},b.prototype.getMaxTrials=function(){var a=this.maxTrials;return a},b.prototype.getProblem=function(){var a=0;return this.currentTrial&&this.currentTrial.problem&&(a=this.currentTrial.problem),a},b.prototype.getNumberClass=function(a){return this.currentTrial&&this.currentTrial.answer&&this.currentTrial.answer!=this.getProblem()&&a==this.currentTrial.answer?"number-wrong":a!=this.getProblem()?"number-disabled":"waiting"==this.getView()?"number-disabled":"number-selected"},b.prototype.cancelLastTrial=function(){console.log("Cancel Last Trial"),this.trials.pop()},b.prototype.endSession=function(){console.log("End Session"),this.initialize()},b.prototype.setMessage=function(a){this.message=a},b.prototype.getMessage=function(){return this.message},b.prototype.hello=function(){return $("#hellobutton").attr("disabled","disabled"),"TESTING"},b.prototype.saveSession=function(){console.log("saveSession"),$("#savebutton").attr("disabled","disabled");var a="[Here is the session data.]";this.saveResult="Trying to save.";var b=ocpu.rpc("saveSession",{thesessiondata:a},function(a){this.saveResult=a});return b.fail(function(){alert("Server error: "+b.responseText)}),b.always(function(){$("#submitbutton").removeAttr("disabled")}),"TESTING"},b}()}]),myApp.controller("ReactionTimeCtrl",["$scope","ReactionTimeSession",function(a,b){return a.test=new b,a.test.hello=function(){var b;b.then(function(b){a.test.message=b.message[0],console.log("result.message[0]:",b.message[0]," result:",b)},function(a){console.log("hello status:",a)})},a.test.saveTrials=function(){{var a;this.trials}a.then(function(a){console.log("saveTrials:",a)},function(a){console.log("saveTrials status:",a)})},a.test}]);var overwriteWithout=function(a,b){for(var c=a.length;c>=0;c--)a[c]===b&&a.splice(c,1)},isSet=function(a,b){return _.isUndefined(b)?!1:""===b?!0:a.$eval(b)};myApp.factory("shortcuts",["$document",function(a){var b=[],c={"delete":8,tab:9,enter:13,"return":13,esc:27,space:32,left:37,up:38,right:39,down:40,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},d=function(a,b){for(var d=a.length,e=0;d>e;e++)c[a[e]]=b+e};d("1234567890",49),d("abcdefghijklmnopqrstuvwxyz",65);var e={};_.forEach(c,function(a,b){e[a]=b});var f={shift:"shift",ctrl:"ctrl",meta:"meta",alt:"alt"},g=function(a){var b=a.split("+"),d={};return _.forEach(f,function(a){d[a]=!1}),_.forEach(b,function(a){var b=f[a];if(b)d[b]=!0;else if(d.keyCode=c[a],!d.keyCode)return}),d},h=function(a){var b={};return b.keyCode=c[e[a.which]],b.meta=a.metaKey||!1,b.alt=a.altKey||!1,b.ctrl=a.ctrlKey||!1,b.shift=a.shiftKey||!1,b},i=function(a,b){return a.keyCode===b.keyCode&&a.ctrl===b.ctrl&&a.alt===b.alt&&a.meta===b.meta&&a.shift===b.shift};return a.bind("keydown",function(a){var c=$(a.target);if(!c.is('input[type="text"], textarea'))for(var d,e=h(a),f=b.length-1;f>=0;f--)if(d=b[f],i(e,d.keys))return a.preventDefault(),void d.action()}),{shortcuts:b,register:function(a){return a.keys=g(a.keySet),a.keys?(b.push(a),a):void 0},unregister:function(a){overwriteWithout(b,a)}}}]),myApp.directive("ngShortcut",["$parse","shortcuts",function(a,b){return{restrict:"A",link:function(c,d,e){var f=c.$eval(e.ngShortcut);if(!_.isUndefined(f)){f=f.split("|");var g=_.ignore,h=function(a){return function(){d.trigger(a)}};if(isSet(c,e.ngShortcutClick))g=h("click");else if(isSet(c,e.ngShortcutFocus))g=h("focus");else if(isSet(c,e.ngShortcutFastClick))g=h("click");else if(e.ngShortcutNavigate){var i=c.$eval(e.ngShortcutNavigate);g=function(){navigation.redirect(i,!0)}}else if(e.ngShortcutAction){var j=a(e.ngShortcutAction);g=function(){c.$apply(function(){j(c)})}}_.forEach(f,function(a){var d=b.register({keySet:a,action:g,description:e.ngShortcutDescription||""});c.$on("$destroy",function(){b.unregister(d)})})}}}}]);